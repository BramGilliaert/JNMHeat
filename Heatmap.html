<html>
<head>
	<title>A Leaflet map!</title>
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
	<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
	<script src="jquery-3.3.1.min.js"></script>
	<style>
		#map{ width: 1700px; height: 900; }
	</style>
</head>
<body>

	<div id="map"></div>

 <script>

	function nodeDict(nodeData){
	var dict = new Object();
	for (var i = 0; i < nodeData.elements.length; i++){
		var node = nodeData.elements[i];
		if(node.type != 'node'){
			continue;
		}
		dict[node.id] = node;
	}
	return dict;

	}



	/* The string (html) that is shown within a popup
	*/
	function popupString(lokaal) {
		
		var link = lokaal.tags.website;
		if(link == null){
			link = lokaal.tags.name;
		}else{
			link = "<a href='"+lokaal.tags.website+"' target='_blank'>"+lokaal.tags.name+"</a>"
		}

		var descr;
		if(lokaal.tags.shop == "gift"){
			// This is a special case for the shop
			descr = "";;
		}else{
			// This is a generic youth movement space
			descr = "Lokaal van "
		}

		return descr + link;

	}


	// fancy icon to show on a venue
	var jnmIcon = L.icon({iconUrl: 'JNMLogo.jpg', iconSize: [37,27], iconAnchor: [18, 0], popupAnchor: [0,0]});


	function pickIcon(lokaalInfo){
		return jnmIcon;
	}


	// initialize the map
	var map = L.map('map').setView([50.9, 3.9], 9);

	// load a tile layer
	L.tileLayer('http://tile.openstreetmap.be/osmbe/{z}/{x}/{y}.png',
		{
		attribution: 'Map Data Copyright OpenStreetMap | Lokalendata aanpasbaar via osm.org | Activiteitendata van JNM.be | Tiles hosted by osm.be',
		maxZoom: 17,
		minZoom: 9
		}).addTo(map);





	// load data about the spaces from file, and use it
	$.get("Lokalen.geojson", function( data ) {

		var lokalen = JSON.parse(data);

		// maps ids on their nodes
		var nodes = nodeDict(lokalen);

		for (var i = 0; i < lokalen.elements.length; i++){
			var lokaal = lokalen.elements[i];

			if(lokaal.tags == null){
				// probably just part of a building. Skip this shit
				continue;
			}

			if(lokaal.tags.name == null){
					console.log("Name not defined for location, skipping it");
					console.Log(lokaal);
					continue;
			}

			if(lokaal.lat == null || lokaal.lon == null){
				console.log("Latitude or longitude are missing for "+lokaal.tags.name+", taking one of the first node");
				lokaal.lat = nodes[lokaal.nodes[0]].lat;
				lokaal.lon = nodes[lokaal.nodes[0]].lon;
			}

			// create and show marker
			var lokaalM = L.marker([lokaal.lat, lokaal.lon], {icon: pickIcon()}).addTo(map);
			lokaalM.bindPopup(popupString(lokaal));
		} // end of for each venue
	}); // end of data crunching

	</script>


</body>
</html>
